{% comment %}
  Trade-In Cart Template
  Displays all trade-in items selected by the user
{% endcomment %}

{% layout 'theme' %}

<!-- Add CSS at the top -->
{{ 'trade-in.css' | asset_url | stylesheet_tag }}

<div class="trade-in-cart-page">
  <h1>Your Trade-In Items</h1>
  
  {% assign has_trade_in_items = false %}
  {% assign trade_in_total = 0 %}
  
  <div class="trade-in-cart-container">
    <div class="trade-in-cart-header">
      <div class="header-cell item-col">Item</div>
      <div class="header-cell">Type</div>
      <div class="header-cell">Quantity</div>
      <div class="header-cell">Unit Value</div>
      <div class="header-cell">Total Value</div>
      <div class="header-cell">Actions</div>
    </div>
    
    <div class="trade-in-cart-body">
      {% for item in cart.items %}
        {% if item.properties['Trade In'] == 'Yes' %}
          {% assign has_trade_in_items = true %}
          {% assign unit_price = item.properties['Unit Price'] | remove: '£' | times: 1 %}
          {% assign total_price = item.properties['Total Value'] | remove: '£' | times: 1 %}
          {% assign trade_in_total = trade_in_total | plus: total_price %}
          
          <div class="trade-in-cart-row" data-item-id="{{ item.key }}">
            <div class="trade-in-cart-cell item-col">
              <img src="{{ item.image | img_url: 'medium' }}" alt="{{ item.title }}">
              <div class="item-details">
                <p class="item-title">{{ item.product.title }}</p>
                <p class="item-variant">{{ item.variant.title }}</p>
              </div>
            </div>
            <div class="trade-in-cart-cell">
              <span class="trade-in-type {% if item.properties['Trade In Type'] == 'Cash' %}cash-type{% else %}credit-type{% endif %}">
                {{ item.properties['Trade In Type'] }}
              </span>
            </div>
            <div class="trade-in-cart-cell">{{ item.quantity }}</div>
            <div class="trade-in-cart-cell">{{ item.properties['Unit Price'] }}</div>
            <div class="trade-in-cart-cell">{{ item.properties['Total Value'] }}</div>
            <div class="trade-in-cart-cell">
              <button class="remove-item-btn" data-item-key="{{ item.key }}">Remove</button>
            </div>
          </div>
        {% endif %}
      {% endfor %}
      
      {% unless has_trade_in_items %}
        <div class="empty-cart-message">
          <p>You don't have any trade-in items yet. Browse our collections to find items to trade in.</p>
          <a href="/collections/all" class="btn">Browse Collections</a>
        </div>
      {% endunless %}
    </div>
    
    {% if has_trade_in_items %}
      <div class="trade-in-cart-footer">
        <div class="trade-in-summary">
          <div class="summary-row">
            <span>Total Trade-In Value:</span>
            <span class="trade-in-total">£{{ trade_in_total | round: 2 }}</span>
          </div>
          
          <div class="trade-in-actions">
            <button id="clear-trade-ins" class="btn btn--secondary">Clear All Trade-Ins</button>
            <button id="proceed-trade-in" class="btn">Proceed with Trade-In</button>
          </div>
        </div>
      </div>
    {% endif %}
  </div>
</div>

<!-- Add JavaScript with defer for better performance -->
<script src="{{ 'trade-in.js' | asset_url }}" defer></script>